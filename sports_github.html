<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sports Record | Xu Yu-Chia</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .text-gradient{
      background: linear-gradient(90deg, #22d3ee 0%, #6366f1 50%, #a855f7 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-200">
  <header class="bg-gray-900 text-white p-4 shadow-md sticky top-0 z-10">
        <nav class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="text-xl font-bold"><a href ="https://xu-yu-chia.github.io/#home"><i class="fa fa-home"></i></a> Xu Yu-Chia's Blog</div>
            <ul class="flex space-x-6">
                <li><a href="https://xu-yu-chia.github.io/#about" class="hover:text-gray-400"><i class="fa fa-address-card"> About Me</i></a></li>
                <li><a href="https://xu-yu-chia.github.io/#projects" class="hover:text-gray-400"><i class="fa fa-folder-open"> Projects</i></a></li>
                <li><a href="https://xu-yu-chia.github.io/blog" class="hover:text-gray-400"><i class="fas fa-pen"> Blogs</i></a></li>
                <li><a href="sports.html" class="hover:text-gray-400"><i class="fa fa-running"> Sports Record</i></a></li>
                <li><a href="https://xu-yu-chia.github.io/#contact" class="hover:text-gray-400"><i class="fa fa-phone"> Contact Me</i></a></li>
                <li>
                  <a href="teacher.html" class="hover:text-gray-400">
                    <i class="fa fa-file"></i>
                  </a>
                </li>
            </ul>
        </nav>
    </header>

  <main class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center text-gradient">運動紀事</h1>

    <!-- 個人最佳紀錄 (PB) - 將由 history.json 自動計算 -->
    <section class="mb-8 bg-gradient-to-r from-indigo-600 via-blue-500 to-purple-600 p-6 rounded-lg shadow-xl">
      <h2 class="text-2xl font-semibold text-white mb-4">個人最佳紀錄 (PB)</h2>
      <ul class="space-y-4" id="pb-list"></ul>
    </section>

    <!-- 預計參加的賽事（若不使用可刪除整段） -->
    <section class="mb-8 p-6 bg-gradient-to-r from-green-500 via-teal-400 to-cyan-300 rounded-lg shadow-xl">
      <h2 class="text-2xl font-semibold text-white mb-4">預計參加的賽事</h2>
      <ul class="space-y-4" id="upcoming-list"></ul>
    </section>

    <!-- 參加過的賽事 -->
    <section class="mb-8 p-6 bg-gradient-to-r from-pink-500 via-orange-400 to-yellow-300 rounded-lg shadow-xl">
      <h2 class="text-2xl font-semibold text-white mb-4">參加過的賽事</h2>
      <ul class="space-y-4" id="history-list"></ul>
    </section>
  </main>

  <footer class="bg-gray-900 text-gray-400 text-center py-4 mt-10">
    <p>© 2025 Xu Yu-Chia. 保留所有權利.</p>
  </footer>

  <script>
    // ======= 將下面三個變數換成你的 GitHub 倉庫資訊 =======
    const GITHUB_USER = "xu-yu-chia";           // 例: xu-yu-chia
    const GITHUB_REPO = "xu-yu-chia.github.io";           // 例: xu-yu-chia.github.io 或你的專案名
    const GITHUB_BRANCH = "main";         // 例: main 或 master

    const base = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/docs/sport_record`;

    async function fetchJSON(name){
      const res = await fetch(`${base}/${name}.json?ts=${Date.now()}`, { cache: 'no-store' });
      if(!res.ok) throw new Error(`fetch ${name} failed: ${res.status}`);
      return res.json();
    }

    function renderHistory(rows){
      const ul = document.getElementById('history-list');
      if (!ul) return;
      ul.innerHTML = '';
      rows.forEach(({race='', info=''}) => {
        const li = document.createElement('li');
        li.className = 'p-4 bg-gray-800 rounded-lg shadow-lg hover:scale-105 transform transition duration-300';
        li.innerHTML = `
          <p class="text-lg font-semibold text-pink-300">${race}</p>
          <p class="text-gray-400">${info}</p>
        `;
        ul.appendChild(li);
      });
    }

    function detectCategory(text){
      if (/全馬|馬拉松(?!_半馬)/i.test(text)) return '馬拉松';
      if (/半馬/i.test(text)) return '半馬';
      if (/(?:^|\b)(10k|10Ｋ|10ｋ|10公里)/i.test(text)) return '10K';
      if (/(?:^|\b)(5k|5Ｋ|5ｋ|5公里)/i.test(text)) return '5K';
      if (/(?:^|\b)(3k|3Ｋ|3ｋ|3公里)/i.test(text)) return '3K';
      return null;
    }

    function parseTimeToSec(s){
      if (!s) return Infinity;
      const norm = s.replace(/[：﹕]/g, ':').replace(/\s/g, '');
      const m = norm.match(/(\d+):(\d{1,2})(?::(\d{1,2}))?/);
      if(!m) return Infinity;
      const h = m[3] ? parseInt(m[1],10) : 0;
      const mm = m[3] ? parseInt(m[2],10) : parseInt(m[1],10);
      const ss = m[3] ? parseInt(m[3],10) : parseInt(m[2],10);
      return h*3600 + mm*60 + ss;
    }

    function renderPBFromHistory(rows){
      const best = {};
      rows.forEach(({race='', info=''}) => {
        const cat = detectCategory(race + ' ' + info);
        if(!cat) return;
        const tMatch = (race + ' ' + info).match(/(\d+\s*[：:]\s*\d{1,2}(?:\s*[：:]\s*\d{1,2})?)/);
        const sec = parseTimeToSec(tMatch?.[1]);
        if (sec === Infinity) return;

        const placeMatch = (info.match(/(.*?)(?:，|,)\s*完賽時間/) || race.match(/_(.*)$/));
        const place = placeMatch ? placeMatch[1].trim() : '';

        if (!best[cat] || sec < best[cat].sec) {
          best[cat] = { sec, record: tMatch[1].replace(/\s/g,''), place };
        }
      });

      const ul = document.getElementById('pb-list');
      if (!ul) return;
      ul.innerHTML = '';
      const order = ['馬拉松','半馬','10K','5K','3K'];
      order.forEach(cat => {
        if (!best[cat]) return;
        const li = document.createElement('li');
        li.className = 'p-4 bg-gray-800 rounded-lg shadow-lg hover:scale-105 transform transition duration-300';
        li.innerHTML = `
          <p class="text-lg font-semibold text-blue-300">${cat}： ${best[cat].record}</p>
          <p class="text-gray-400">地點：${best[cat].place || '—'}</p>
        `;
        ul.appendChild(li);
      });
    }

    function renderUpcoming(rows){
      const ul = document.getElementById('upcoming-list');
      if (!ul) return;
      ul.innerHTML = '';
      rows.forEach(({name='', note=''}) => {
        const li = document.createElement('li');
        li.className = 'p-4 bg-gray-800 rounded-lg shadow-lg hover:scale-105 transform transition duration-300';
        li.innerHTML = `
          <p class="text-lg font-semibold text-teal-200">${name}</p>
          <p class="text-gray-200">${note}</p>
        `;
        ul.appendChild(li);
      });
    }

    async function init(){
      try{
        const history = await fetchJSON('history'); // 只抓 history.json
        renderHistory(history);
        renderPBFromHistory(history);
        // 若未使用 upcoming.json，可刪掉下列兩行
        // const upcoming = await fetchJSON('upcoming');
        // renderUpcoming(upcoming);
      }catch(e){
        console.error(e);
      }
    }
    init();
  </script>
</body>
</html>
